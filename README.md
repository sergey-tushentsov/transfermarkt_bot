### Описание проекта
Telegram-бот для получения информации с портала transfermarkt.

### Как запустить
Для корректной работы бота необходимо в корне проекта создать виртуальное окружение.
Виртуальное окружение для ОС Windows можно создать следующей командой в командной
строке:  
py -m venv .venv  
Активировать виртуальное окружение можно в командной строке командой:  
.venv\Scripts\activate  

Далее необходимо установить 3 библиотеки: pyTelegramBotAPI, python-dotenv, requests. Все 
необходимые библиотеки можно установить с помощью команды:  
py -m pip install -r requirements.txt  
При этом у вас должен быть установлен менеджер пакетов pip.

Запуск бота выполняется из модуля main.py. Для запуска бота в консоли введите:  
python main.py

### Как пользоваться

#### default command:

**/start** - старт, команда для начала работы бота. Приветствует пользователя.

**/help** - помощь, выводит список доступных команд бота.

#### custom command:

**/most_value** - выводит самого дорогого футболиста команды на текущий момент.
Предварительно у пользователя запрашивается наименование (латиницей) интересующей 
его команды. После ввода наименования команды пользователь получает список команд, 
в названии которых присутствует введенное наименование.  

Для выполнения всех запросов к API в пакете utils в модуле my_requests.py разработана 
функция api_request.

Запрос с параметрами (выполняется в функции find_teams):  
```
querystring = {"query": team, "domain": "com"}  
json_data = my_requests.api_request('search', querystring)
```
Функция find_teams также создает и возвращает словарь, в котором хранятся наименования 
команд и их id.

Пример ответа запроса (для экономии пространства ответ показан частично):  

```console
{"count":
    {"players": 0,
    "coaches": 0,
    "clubs": 6,
    "competitions": 0,
    "referees": 0},
    "clubs":
        [
            {"id": "985",
            "league": "GB1",
            "competitionID": "GB1",
            "competitionName": "Premier League",
            "name": "Manchester United",
            "logoImage": "https://tmssl.akamaized.net//images/wappen/medium/985.png?lm=1457975903"}
            
            {"id": "9251",
            "league": "GB21",
            "competitionID": "GB21",
            "competitionName": "Premier League 2",
            "name": "Manchester United U21",
```
После выполнения вышеуказанного запроса пользователю выводится список команд, 
в названии которых присутствует введенное ранее наименование. А также выводится 
клавиатура ReplyKeyboard, содержащая кнопки с номерами команд из списка (от 1 до 
общего количества команд).  
Пользователь нажимает на кнопку с номером, который соответствует номеру команды по 
списку. На основании выбранной команды по ее id выполняется запрос на получение 
списка игроков данной команды.  

Запрос с параметрами (выполняется в функции find_all_players):  
```
querystring = {"id": team_id, "saison_id": 2025, "domain": "com"}
json_data = my_requests.api_request('clubs/get-squad', querystring)
```

Пример ответа запроса (для экономии пространства ответ показан частично):  

```console
{"squad":
    [
        0:
            {"height": "1,81",
            "foot": "rechts",
            "injury": "null",
            ...
            "marketvalue":
                {"value": 2500000,
                "currency": "€",
                "progression": "null"}
            }
    ]
}
```
Далее перебором определяем игрока с максимальной стоимостью и выводим его параметры:  
1. имя и фамилия;
2. цена;
3. возраст.

**/awards** - выводит параметры игрока / игроков, получивших или претендующих 
на определенные награды.  

Первоначально пользователю предлагается на выбор 3 типа индивидуальных наград 
футболистов (реализованы 3 кнопки InlineKeyboardButton):  
1. best fifa player (лучший игрок последнего сезона по версии FIFA);
2. golden boot (список из 3-х футболистов с наибольшим количеством очков за 
забитые голы на данный момент);
3. clean sheets (список 3-х лучших вратарей по количеству "сухих" матчей в сезоне 
на данный момент).


best fifa player: 
```
querystring = {'domain': 'com'}
    players = my_requests.api_request('statistic/list-best-fifa-players',
                                      querystring)
```
Переменная players содержит список всех игроков года по версии FIFA с 1991 года 
по 2024 год.

golden boot:
```
querystring = {'domain': 'com'}
    players = my_requests.api_request('statistic/list-golden-boot',
                                      querystring)
```
Переменная players содержит список из 50 футболистов, лидирующих на данный момент 
в споре за награду.

clean sheets:
```
querystring = {'domain': 'com'}
    players = my_requests.api_request('statistic/list-clean-sheets',
                                      querystring)
```
Переменная players содержит список из 99 вратарей, лидирующих на данный момент 
в споре за награду.

Пример ответа запроса для best fifa player (для экономии пространства ответ 
показан частично):

```console
{
    "share":
        {
        ...
        }
    "player":
        [0: 
            {"year: 2021,
            "playerName": "R. Lewandowski",
            "firstName": "Robert",
            ...
            "marketValueAtThisTimeNumeral": "Mio."}
        1:
            {"year: 2020,
            ...
            "marketValueAtThisTimeNumeral": "Mio."}
        ]
}
```

В зависимости от выбранной пользователем награды выводим следующие параметры игроков.  
best fifa player
1. имя и фамилия;
2. клуб;
3. возраст;
4. текущая стоимость.  

golden boot (по каждому из 3-х футболистов)
1. имя и фамилия;
2. количество очков;
3. количество голов;
4. команда.  

clean sheets (по каждому из 3-х вратарей)
1. имя и фамилия;
2. количество матчей;
3. количество "cухих" матчей;
4. количество пропущенных голов;
5. команда.

**/history** - история, выводит пользователю историю его запросов с указанием 
даты и времени запроса и его расширенного наименования.

### Этапы реализации бота
1. Выбор API и изучение документации.
2. Составление файла README.md.
3. Реализация вышеуказанных запросов и состояний (StatesGroup).
4. Реализация команды /history (SQL, Peewee).
5. Тестирование бота.
